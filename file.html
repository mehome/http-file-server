<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>@Trinity - Generování url</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="res/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="res/bootstrap-theme.min.css">


    <style type="text/css">
        [ng-click],
        [data-ng-click],
        [x-ng-click] {
            cursor: pointer;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
</head>
<body>

<div class="row centered-form center-block">
    <div class="container col-md-6 col-md-offset-3">
        <div class="page-header">
            <h1>@Trinity</h1>
        </div>

        <ul class="nav nav-tabs">
            <li class="active"><a class="tab-gen">Generování url</a></li>
            <li><a class="tab-links">Aktivní url</a></li>
        </ul>

        <div class="page" ng-app="MyApp" ng-controller="MyCtrl">

            <div id="result"></div>

            <div class="page-gen">

                <form id="form">

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group input-group-count">

                                <label for="count">Počet stažení</label>
                                <div class="input-group">
            <span class="input-group-addon">
                <input type="radio" checked name="type" value="count"/>
            </span>
                                    <input type="number" name="count" min="1" max="100000" value="5"
                                           class="form-control"/>
                                </div>

                                <span style="display:none" class="help-block">Počet musí být v intervalu &lt;1,100000&gt;</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group input-group-expire">
                                <label for="expire">Doba platnosti</label>
                                <div class="input-group">
                <span class="input-group-addon">
                    <input type="radio" name="type" value="expire"/>
                </span>
                                    <input type="time" name="expire" value="01:00" disabled class="form-control"/>
                                </div>
                                <span style="display:none" class="help-block">Platnost musí být ve formátu HH:SS.</span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="form-group input-group-path">
                                <label for="path">Cesta k souboru</label>
                                <div class="input-group">
                                    <span class="input-group-addon item" id="prefix"></span>
                                    <input type="text" name="path" class="form-control" ng-model="cwd"></input>
                                    <span class="input-group-btn">
                    <button class="btn btn-default" name="go"
                            data-loading-text="<i class='glyphicon glyphicon-refresh gly-spin'></i> Vygeneruj"
                            type="button">Vygeneruj</button>
                </span>
                                </div>
                                <span style="display:none" class="help-block">Nebyla vyplněna cesta k souboru.</span>
                            </div>
                        </div>
                    </div>

                </form>

                <div class="panel panel-default">
                    <div class="panel-body" id="files">
                        <div class="loader-space">
                            <div class="loader"></div>
                        </div>
                        <table>
                            <tr ng-click="linkOnClick($event, link)" ng-repeat="link in links"
                                ng-class="{{ 'link.type' }}">
                                <td>{{ link.name }}</td>
                                <td>{{ link.type }}</td>
                                <td>{{ link.size | fileSize }}</td>
                                <td>{{link.date?(link.date * 1000 | date:'yyyy-MM-dd HH:mm:ss'):"" }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    var GLOBAL_PATH = "/home/vf/"

    var app = angular.module('MyApp', []);

    app.filter('fileSize', function () {
        return function (x) {
            if (x !== null) {
                var size, unit;
                if (x > 1024 * 1024 * 1024) {
                    size = Math.round(x / (1024 * 1024 * 1024) * 100) / 100;
                    unit = 'GB';
                } else if (x > 1024 * 1024) {
                    size = Math.round(x / (1024 * 1024) * 100) / 100;
                    unit = 'MB';
                } else if (x > 1024) {
                    size = Math.round(x / 1024 * 100) / 100;
                    unit = 'kB';
                } else {
                    size = x;
                    unit = 'B';
                }

                return size + " " + unit;
            }

            return "";
        };
    });

    app.controller('MyCtrl', ['$scope', '$http', function ($scope, $http) {
        $scope.cwd = GLOBAL_PATH;
        getLinks($scope.cwd);

        function getLinks(_path) {
            _path = _path.replace(GLOBAL_PATH, '');
            $http.get("admin", {params: {path: _path}}).then(function mySucces(response) {
                $scope.links = response.data;
            }, function myError(response) {
                $scope.links = response.statusText;
            })
        };


        $scope.linkOnClick = function ($event, link) {
            $scope.cwd = link.path
            if (link.type == "dir") {
                getLinks($scope.cwd);
            }
        }
    }]);
</script>

</body>
</html>
